---
phase: 05-swarm-intelligence
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [hooks/swarm/__init__.py, hooks/swarm/hive_manager.py]
autonomous: true
---

<objective>
Implement the core swarm lifecycle management hook using claude-flow hive-mind commands.

Purpose: Enable automatic swarm initialization, worker spawning, status monitoring, and shutdown for parallel task execution.
Output: `hooks/swarm/hive_manager.py` with full lifecycle functions callable from hooks and skills.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-swarm-intelligence/05-CONTEXT.md
@.planning/phases/05-swarm-intelligence/05-RESEARCH.md

# Prior phase for coordination pattern reference:
@hooks/coordination/file_claim.py
@hooks/core/mcp_client.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create hooks/swarm module structure</name>
  <files>hooks/swarm/__init__.py</files>
  <action>
    Create the hooks/swarm/ directory and __init__.py with exports:
    - Create `hooks/swarm/__init__.py`
    - Export: `hive_manager`
    - Add module docstring explaining swarm hook purpose
    - Follow pattern from `hooks/coordination/__init__.py`
  </action>
  <verify>python3 -c "from hooks.swarm import hive_manager" runs without error (after Task 2)</verify>
  <done>hooks/swarm/ directory exists with __init__.py exporting hive_manager</done>
</task>

<task type="auto">
  <name>Task 2: Create hive_manager.py with lifecycle functions</name>
  <files>hooks/swarm/hive_manager.py</files>
  <action>
    Create `hooks/swarm/hive_manager.py` following the established hook pattern from file_claim.py.

    **Core functions to implement:**

    1. `_run_hive_cmd(args: list[str], timeout: int = 30) -> tuple[bool, str]`
       - Run `npx -y claude-flow@latest hive-mind {args}`
       - Return (success, output)
       - Use subprocess with timeout and cwd=Path.home()

    2. `init_swarm(topology: str = "hierarchical-mesh") -> dict`
       - Call `hive-mind init -t {topology}`
       - Return {"success": bool, "output": str, "hive_id": str|None}
       - Extract hive_id from output if available

    3. `spawn_workers(count: int = 3) -> dict`
       - Call `hive-mind spawn -n {count}`
       - Return {"success": bool, "output": str, "workers": list}

    4. `submit_task(description: str, priority: str = "normal") -> dict`
       - Call `hive-mind task -d "{description}"`
       - Return {"success": bool, "output": str, "task_id": str|None}

    5. `get_status(verbose: bool = True) -> dict`
       - Call `hive-mind status [--verbose]`
       - Return {"success": bool, "output": str, "workers_active": int}

    6. `propose_consensus(topic: str, options: list[str]) -> dict`
       - Call `hive-mind consensus propose --topic "{topic}" --options "{json_options}"`
       - Return {"success": bool, "output": str, "proposal_id": str|None}

    7. `broadcast_message(message: str, target: str = "all") -> dict`
       - Call `hive-mind broadcast -m "{message}" --target {target}`
       - Return {"success": bool, "output": str}

    8. `shutdown_swarm(graceful: bool = True) -> dict`
       - Call `hive-mind shutdown`
       - Return {"success": bool, "output": str}

    **Additional requirements:**
    - Add logging to `/tmp/claude-metrics/swarm.log` (follow file_claim.py pattern)
    - Add `if __name__ == "__main__":` with argparse for CLI testing
    - Support `--action` argument: init|spawn|task|status|consensus|broadcast|shutdown
    - Support relevant flags per action (--topology, --count, --description, etc.)
    - Make script executable with shebang `#!/usr/bin/env python3`

    **AVOID:**
    - Don't create custom message passing (use hive-mind broadcast)
    - Don't implement custom consensus voting (use hive-mind consensus)
    - Don't add configuration files (KISS - use defaults with overridable args)
  </action>
  <verify>
    1. chmod +x hooks/swarm/hive_manager.py
    2. python3 hooks/swarm/hive_manager.py --action status â†’ returns JSON (may show empty/no hive)
    3. python3 -c "from hooks.swarm.hive_manager import init_swarm, get_status; print(get_status())"
  </verify>
  <done>
    - hive_manager.py exists with all 8 functions
    - CLI interface works with --action argument
    - Logging to /tmp/claude-metrics/swarm.log
    - Import works: `from hooks.swarm.hive_manager import init_swarm, spawn_workers, get_status`
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `hooks/swarm/__init__.py` exists and exports hive_manager
- [ ] `hooks/swarm/hive_manager.py` is executable
- [ ] All 8 functions implemented: init_swarm, spawn_workers, submit_task, get_status, propose_consensus, broadcast_message, shutdown_swarm, _run_hive_cmd
- [ ] CLI test: `python3 hooks/swarm/hive_manager.py --action status` returns JSON
- [ ] Import test: `python3 -c "from hooks.swarm import hive_manager; print(hive_manager.get_status())"`
- [ ] Log file created at `/tmp/claude-metrics/swarm.log` on any action
</verification>

<success_criteria>

- All tasks completed
- hive_manager.py can be imported and called programmatically
- CLI interface works for manual testing
- Follows established hook patterns (logging, subprocess, error handling)
</success_criteria>

<output>
After completion, create `.planning/phases/05-swarm-intelligence/05-01-SUMMARY.md`
</output>
