---
phase: 04-coordination-claims
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [hooks/coordination/stuck_detector.py, hooks/coordination/claims_dashboard.py]
autonomous: true
---

<objective>
Implement stuck detection and claims dashboard utilities.

Purpose: Mark claims as stealable when agent session ends (timeout/reassign pattern), provide visibility via dashboard command.

Output: `hooks/coordination/stuck_detector.py` (Stop hook) and `hooks/coordination/claims_dashboard.py` (utility)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/4-coordination-claims/4-RESEARCH.md
@.planning/phases/4-coordination-claims/4-CONTEXT.md

# Existing patterns to follow:
@/media/sam/1TB/claude-hooks-shared/hooks/core/mcp_client.py
@/media/sam/1TB/claude-hooks-shared/hooks/intelligence/trajectory_tracker.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement stuck_detector.py (Stop hook)</name>
  <files>hooks/coordination/stuck_detector.py</files>
  <action>
Create Stop hook that marks any active claims as stealable.

Logic:
1. Load session_id from session state
2. Query all claims for this session via claims_list:
   - claimant filter: "agent:{session_id}:*"
   - status filter: "active"
3. For each active claim:
   - Call claims_mark-stealable:
     - issueId: claim["issueId"]
     - reason: "blocked-timeout"
     - context: "Session ended with active claim"
4. Log marked claims to coordination.log
5. Clear session state file
6. Return {}

This ensures stuck claims can be stolen by other agents.
Handle errors gracefully - session end should never fail.
  </action>
  <verify>python3 hooks/coordination/stuck_detector.py --help shows usage</verify>
  <done>stuck_detector.py created, marks active claims as stealable on Stop</done>
</task>

<task type="auto">
  <name>Task 2: Implement claims_dashboard.py (utility script)</name>
  <files>hooks/coordination/claims_dashboard.py</files>
  <action>
Create utility script to display claims board.

NOT a hook - a standalone utility that can be called manually or from a skill.

Logic:
1. Call claude-flow claims_board via subprocess
2. Parse JSON response
3. Format output as readable table:
   ```
   ═══════════════════════════════════════════════
   CLAIMS DASHBOARD
   ═══════════════════════════════════════════════

   ACTIVE (2):
   ┌─────────────────────────────────────────────┐
   │ file:/path/to/file.py                       │
   │ Claimed by: agent:abc123:editor             │
   │ Since: 2 minutes ago                        │
   └─────────────────────────────────────────────┘

   STEALABLE (1):
   ┌─────────────────────────────────────────────┐
   │ task:hash-12345                             │
   │ Reason: blocked-timeout                     │
   │ Available for: any                          │
   └─────────────────────────────────────────────┘

   Summary: 2 active, 1 stealable, 5 completed
   ═══════════════════════════════════════════════
   ```
4. Support --json flag for raw JSON output
5. Support --watch flag to refresh every 5 seconds

Make executable so it can be run directly:
  python3 hooks/coordination/claims_dashboard.py
  python3 hooks/coordination/claims_dashboard.py --json
  python3 hooks/coordination/claims_dashboard.py --watch
  </action>
  <verify>python3 hooks/coordination/claims_dashboard.py shows claims board</verify>
  <done>claims_dashboard.py created, displays formatted claims board</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] hooks/coordination/stuck_detector.py is executable
- [ ] hooks/coordination/claims_dashboard.py is executable
- [ ] stuck_detector marks claims as stealable
- [ ] claims_dashboard shows formatted output
- [ ] claims_dashboard --json returns valid JSON
</verification>

<success_criteria>
- All tasks completed
- Stuck detector properly marks claims on session end
- Dashboard provides clear visibility into claims state
- Both scripts handle errors gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/4-coordination-claims/04-03-SUMMARY.md`
</output>
