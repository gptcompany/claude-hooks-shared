---
phase: 04-coordination-claims
plan: 04
type: execute
wave: 2
depends_on: ["04-01", "04-02", "04-03"]
files_modified: []
autonomous: false
---

<objective>
Register coordination hooks in settings.json and verify end-to-end functionality.

Purpose: Complete Phase 4 by registering all hooks and verifying the coordination system works.

Output: Updated `~/.claude/settings.json` with coordination hooks registered, verified working system.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/4-coordination-claims/4-RESEARCH.md
@.planning/phases/4-coordination-claims/4-CONTEXT.md

# Prior plan summaries (hooks created):
@.planning/phases/4-coordination-claims/04-01-SUMMARY.md
@.planning/phases/4-coordination-claims/04-02-SUMMARY.md
@.planning/phases/4-coordination-claims/04-03-SUMMARY.md

# Current settings:
@~/.claude/settings.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register coordination hooks in settings.json</name>
  <files>~/.claude/settings.json</files>
  <action>
Add coordination hooks to ~/.claude/settings.json following existing pattern.

Add to PreToolUse:
```json
{
  "matcher": "Write|Edit|MultiEdit",
  "hooks": [
    {
      "type": "command",
      "command": "/media/sam/1TB/claude-hooks-shared/hooks/coordination/file_claim.py",
      "timeout": 5
    }
  ]
}
```
(Add BEFORE existing Write|Edit|MultiEdit hooks so claims happen first)

```json
{
  "matcher": "Task",
  "hooks": [
    {
      "type": "command",
      "command": "/media/sam/1TB/claude-hooks-shared/hooks/coordination/task_claim.py",
      "timeout": 5
    }
  ]
}
```
(Add to existing Task matcher hooks array)

Add to PostToolUse:
```json
{
  "matcher": "Write|Edit|MultiEdit",
  "hooks": [
    {
      "type": "command",
      "command": "/media/sam/1TB/claude-hooks-shared/hooks/coordination/file_release.py",
      "timeout": 5
    }
  ]
}
```
(Add to existing Write|Edit|MultiEdit hooks array)

Add to SubagentStop:
```json
{
  "matcher": "",
  "hooks": [
    {
      "type": "command",
      "command": "/media/sam/1TB/claude-hooks-shared/hooks/coordination/task_release.py",
      "timeout": 5
    }
  ]
}
```
(Add to existing SubagentStop hooks array)

Add to Stop:
```json
{
  "type": "command",
  "command": "/media/sam/1TB/claude-hooks-shared/hooks/coordination/stuck_detector.py",
  "timeout": 5
}
```
(Add to existing Stop hooks array)

Verify JSON is valid after edit.
  </action>
  <verify>cat ~/.claude/settings.json | jq . (valid JSON)</verify>
  <done>All coordination hooks registered in settings.json</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Coordination hooks registered and ready for verification</what-built>
  <how-to-verify>
    1. Start a fresh Claude Code session (new terminal, `claude`)
    2. Run: python3 /media/sam/1TB/claude-hooks-shared/hooks/coordination/claims_dashboard.py
       - Should show empty board (or existing claims from other sessions)
    3. In Claude, create a test file: "Create a file /tmp/test-coordination.txt with 'hello'"
       - Check dashboard: Should show file claim appear then release
    4. Spawn a Task agent: "Use the Task tool to explore the hooks/coordination directory"
       - Check dashboard: Should show task claim appear
       - When agent completes, claim should release
    5. Run dashboard again: Should show completed claims in history
    6. Check logs: cat /tmp/claude-metrics/coordination.log
       - Should show claim/release events
  </how-to-verify>
  <resume-signal>Type "approved" if claims appear correctly, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] settings.json contains all coordination hooks
- [ ] settings.json is valid JSON
- [ ] File edits trigger claim/release cycle
- [ ] Task agents trigger claim/release cycle
- [ ] Dashboard shows claims correctly
- [ ] Logs capture coordination events
</verification>

<success_criteria>
- All tasks completed
- Human verified coordination works end-to-end
- Claims board shows activity
- No errors in coordination.log
</success_criteria>

<output>
After completion, create `.planning/phases/4-coordination-claims/04-04-SUMMARY.md`

Also update ROADMAP.md:
- Phase 4: Coordination | **VERIFIED** | [x] All verification criteria passed
</output>
